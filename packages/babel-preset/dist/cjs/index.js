"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var E=require("@babel/plugin-transform-react-jsx"),m=require("node:path"),g=require("node:url"),c=require("@babel/helper-plugin-utils"),v=require("@babel/types"),d=typeof document<"u"?document.currentScript:null;function h(s){var n=Object.create(null);return s&&Object.keys(s).forEach(function(i){if(i!=="default"){var r=Object.getOwnPropertyDescriptor(s,i);Object.defineProperty(n,i,r.get?r:{enumerable:!0,get:function(){return s[i]}})}}),n.default=s,Object.freeze(n)}var e=h(v);const S=m.dirname(g.fileURLToPath(typeof document>"u"?require("url").pathToFileURL(__filename).href:d&&d.tagName.toUpperCase()==="SCRIPT"&&d.src||new URL("index.js",document.baseURI).href)),J=c.declare(s=>(s.assertVersion(7),{name:"log-jsx-plugin",visitor:{Program(n,i){if(i.filename?.includes(m.resolve(S,"../../../vynn")))return;let r=!1;if(n.get("body").forEach(t=>{t.isImportDeclaration()&&t.node.source.value==="vynn/jsx-runtime"&&t.node.specifiers.forEach(o=>{if(e.isImportSpecifier(o)){const l=o.imported;e.isIdentifier(l)&&l.name==="logJsx"&&(r=!0)}})}),!r){const t=e.importDeclaration([e.importSpecifier(e.identifier("logJsx"),e.identifier("logJsx"))],e.stringLiteral("vynn/jsx-runtime"));n.unshiftContainer("body",t)}},CallExpression(n){const i=n.get("callee");if(e.isMemberExpression(i.node)&&e.isIdentifier(i.node.object,{name:"console"})&&e.isIdentifier(i.node.property)){const r=n.node.arguments.map(t=>e.isJSXElement(t)||e.isJSXFragment(t)?e.callExpression(e.identifier("logJsx"),[t]):t);r.some((t,o)=>t!==n.node.arguments[o])&&(n.node.arguments=r)}}}})),w=c.declare(s=>(s.assertVersion(7),{name:"loop-auto-wrap-plugin",pre(){const n=this.file.metadata;n.importedLoops=new Set,n.localLoops=new Set},visitor:{Program(n,i){const r=i.file.metadata,t=r.importedLoops,o=r.localLoops;n.get("body").forEach(l=>{l.isImportDeclaration()&&l.node.source.value==="vynn"&&l.node.specifiers.forEach(a=>{e.isImportSpecifier(a)&&e.isIdentifier(a.imported,{name:"loop"})&&t.add(a.local.name)}),l.isFunctionDeclaration()&&e.isIdentifier(l.node.id)&&o.add(l.node.id.name),l.isVariableDeclaration()&&l.node.declarations.forEach(a=>{e.isIdentifier(a.id)&&o.add(a.id.name)})})},CallExpression(n,i){const r=i.file.metadata,t=r.importedLoops,o=r.localLoops,l=n.get("callee");if(!l.isIdentifier())return;const a=l.node.name;if(t.has(a)&&!o.has(a)&&n.node.arguments.length===1){const p=n.node.arguments[0];!e.isArrowFunctionExpression(p)&&e.isExpression(p)&&(n.node.arguments[0]=e.arrowFunctionExpression([],p))}}}})),j=c.declare(s=>{s.assertVersion(7);function n(i){const r=[];if(i.node.children.forEach((o,l)=>{if(e.isJSXText(o)){let a=o.value;(!a.includes(`
`)||a.trim()!=="")&&(l===0&&(a=a.trimStart()),l===i.node.children.length-1&&(a=a.trimEnd()),r.push(e.arrowFunctionExpression([],e.stringLiteral(a))))}else if(e.isJSXElement(o)||e.isJSXFragment(o))r.push(e.arrowFunctionExpression([],o));else if(e.isJSXExpressionContainer(o)&&!e.isJSXEmptyExpression(o.expression)){const a=o.expression;e.isStringLiteral(a)?r.push(a):r.push(e.arrowFunctionExpression([],a))}}),r.length===0)return;let t=r.length===1?r[0]:e.arrayExpression(r);e.isArrowFunctionExpression(t)||(t=e.arrowFunctionExpression([],t)),i.node.children=[e.jsxExpressionContainer(t)]}return{name:"wrap-jsx-children-plugin",visitor:{JSXElement(i){n(i)},JSXFragment(i){n(i)}}}}),b=c.declare(s=>(s.assertVersion(7),{name:"wrap-jsx-expression-plugin",visitor:{JSXOpeningElement(n){const i=n.node.attributes.map(r=>{if(!e.isJSXAttribute(r)||!r.value)return r;const t=e.isJSXIdentifier(r.name)?r.name.name:null;if(t==="ref"&&e.isJSXExpressionContainer(r.value)&&e.isIdentifier(r.value.expression)){const a=r.value.expression,p=e.identifier("elem"),f=e.assignmentExpression("=",a,p),x=e.arrowFunctionExpression([p],f);return e.jsxAttribute(e.jsxIdentifier(t),e.jsxExpressionContainer(x))}let o=null;if(e.isStringLiteral(r.value)?o=r.value:e.isJSXExpressionContainer(r.value)&&(e.isJSXEmptyExpression(r.value.expression)||(o=r.value.expression)),o===null||t===null)return r;const l=e.arrowFunctionExpression([],o);return e.jsxAttribute(e.jsxIdentifier(t),e.jsxExpressionContainer(l))});n.node.attributes=i},JSXExpressionContainer(n){const i=n.node.expression;if(e.isJSXEmptyExpression(i)||e.isFunction(i)||e.isArrowFunctionExpression(i)||e.isLiteral(i))return;const r=e.arrowFunctionExpression([],i);n.replaceWith(e.jsxExpressionContainer(r))}}}));function u(s){return s?e.isJSXElement(s)||e.isJSXFragment(s)?!0:e.isConditionalExpression(s)?u(s.consequent)||u(s.alternate):e.isLogicalExpression(s)?u(s.left)||u(s.right):e.isArrayExpression(s)?s.elements.some(n=>n&&!e.isSpreadElement(n)?u(n):!1):!1:!1}const F=c.declare(s=>(s.assertVersion(7),{name:"wrap-jsx-variables",visitor:{VariableDeclarator(n){const i=n.node.init;i&&u(i)&&!e.isArrowFunctionExpression(i)&&(n.node.init=e.arrowFunctionExpression([],i))},AssignmentExpression(n){const i=n.node.right;u(i)&&!e.isArrowFunctionExpression(i)&&(n.node.right=e.arrowFunctionExpression([],i))}}}));function y(s,n={ssr:!1}){return s.assertVersion(7),{plugins:[[E,{runtime:"automatic",importSource:n.ssr?"vynn/server":"vynn",jsx:"preserve"}],J,F,w,j,b]}}exports.default=y;
//# sourceMappingURL=index.js.map
