"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var x=require("@babel/plugin-transform-react-jsx"),d=require("node:path"),g=require("node:url"),p=require("@babel/helper-plugin-utils"),E=require("@babel/types"),c=typeof document<"u"?document.currentScript:null;function v(l){var r=Object.create(null);return l&&Object.keys(l).forEach(function(i){if(i!=="default"){var n=Object.getOwnPropertyDescriptor(l,i);Object.defineProperty(r,i,n.get?n:{enumerable:!0,get:function(){return l[i]}})}}),r.default=l,Object.freeze(r)}var e=v(E);const h=d.dirname(g.fileURLToPath(typeof document>"u"?require("url").pathToFileURL(__filename).href:c&&c.tagName.toUpperCase()==="SCRIPT"&&c.src||new URL("cjs/index.js",document.baseURI).href)),S=p.declare(l=>(l.assertVersion(7),{name:"log-jsx-plugin",visitor:{Program(r,i){if(i.filename?.includes(d.resolve(h,"../../../vynn")))return;let n=!1;if(r.get("body").forEach(s=>{s.isImportDeclaration()&&s.node.source.value==="vynn/jsx-runtime"&&s.node.specifiers.forEach(t=>{if(e.isImportSpecifier(t)){const a=t.imported;e.isIdentifier(a)&&a.name==="logJsx"&&(n=!0)}})}),!n){const s=e.importDeclaration([e.importSpecifier(e.identifier("logJsx"),e.identifier("logJsx"))],e.stringLiteral("vynn/jsx-runtime"));r.unshiftContainer("body",s)}},CallExpression(r){const i=r.get("callee");if(e.isMemberExpression(i.node)&&e.isIdentifier(i.node.object,{name:"console"})&&e.isIdentifier(i.node.property)){const n=r.node.arguments.map(s=>e.isJSXElement(s)||e.isJSXFragment(s)?e.callExpression(e.identifier("logJsx"),[s]):s);n.some((s,t)=>s!==r.node.arguments[t])&&(r.node.arguments=n)}}}})),J=p.declare(l=>(l.assertVersion(7),{name:"loop-auto-wrap-plugin",pre(){const r=this.file.metadata;r.importedLoops=new Set,r.localLoops=new Set},visitor:{Program(r,i){const n=i.file.metadata,s=n.importedLoops,t=n.localLoops;r.get("body").forEach(a=>{a.isImportDeclaration()&&a.node.source.value==="vynn"&&a.node.specifiers.forEach(o=>{e.isImportSpecifier(o)&&e.isIdentifier(o.imported,{name:"loop"})&&s.add(o.local.name)}),a.isFunctionDeclaration()&&e.isIdentifier(a.node.id)&&t.add(a.node.id.name),a.isVariableDeclaration()&&a.node.declarations.forEach(o=>{e.isIdentifier(o.id)&&t.add(o.id.name)})})},CallExpression(r,i){const n=i.file.metadata,s=n.importedLoops,t=n.localLoops,a=r.get("callee");if(!a.isIdentifier())return;const o=a.node.name;if(s.has(o)&&!t.has(o)&&r.node.arguments.length===1){const u=r.node.arguments[0];!e.isArrowFunctionExpression(u)&&e.isExpression(u)&&(r.node.arguments[0]=e.arrowFunctionExpression([],u))}}}})),j=p.declare(l=>{l.assertVersion(7);function r(i){const n=[];if(i.node.children.forEach((t,a)=>{if(e.isJSXText(t)){let o=t.value;(!o.includes(`
`)||o.trim()!=="")&&(a===0&&(o=o.trimStart()),a===i.node.children.length-1&&(o=o.trimEnd()),n.push(e.arrowFunctionExpression([],e.stringLiteral(o))))}else if(e.isJSXElement(t)||e.isJSXFragment(t))n.push(e.arrowFunctionExpression([],t));else if(e.isJSXExpressionContainer(t)&&!e.isJSXEmptyExpression(t.expression)){const o=t.expression;e.isStringLiteral(o)?n.push(o):n.push(e.arrowFunctionExpression([],o))}}),n.length===0)return;let s=n.length===1?n[0]:e.arrayExpression(n);e.isArrowFunctionExpression(s)||(s=e.arrowFunctionExpression([],s)),i.node.children=[e.jsxExpressionContainer(s)]}return{name:"wrap-jsx-children-plugin",visitor:{JSXElement(i){r(i)},JSXFragment(i){r(i)}}}}),w=p.declare(l=>(l.assertVersion(7),{name:"wrap-jsx-expression-plugin",visitor:{JSXOpeningElement(r){const i=r.node.attributes.map(n=>{if(!e.isJSXAttribute(n)||!n.value)return n;const s=e.isJSXIdentifier(n.name)?n.name.name:null;if(s==="ref"&&e.isJSXExpressionContainer(n.value)&&e.isIdentifier(n.value.expression)){const o=n.value.expression,u=e.identifier("elem"),m=e.assignmentExpression("=",o,u),f=e.arrowFunctionExpression([u],m);return e.jsxAttribute(e.jsxIdentifier(s),e.jsxExpressionContainer(f))}let t=null;if(e.isStringLiteral(n.value)?t=n.value:e.isJSXExpressionContainer(n.value)&&(e.isJSXEmptyExpression(n.value.expression)||(t=n.value.expression)),t===null||s===null)return n;const a=e.arrowFunctionExpression([],t);return e.jsxAttribute(e.jsxIdentifier(s),e.jsxExpressionContainer(a))});r.node.attributes=i},JSXExpressionContainer(r){const i=r.node.expression;if(e.isJSXEmptyExpression(i)||e.isFunction(i)||e.isArrowFunctionExpression(i)||e.isLiteral(i))return;const n=e.arrowFunctionExpression([],i);r.replaceWith(e.jsxExpressionContainer(n))}}}));function y(l,r={ssr:!1}){return l.assertVersion(7),{plugins:[[x,{runtime:"automatic",importSource:r.ssr?"vynn/server":"vynn",jsx:"preserve"}],S,J,j,w]}}exports.default=y;
//# sourceMappingURL=index.js.map
