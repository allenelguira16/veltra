import f from"@babel/plugin-transform-react-jsx";import m from"node:path";import{fileURLToPath as E}from"node:url";import{declare as c}from"@babel/helper-plugin-utils";import*as e from"@babel/types";const g=m.dirname(E(import.meta.url)),S=c(o=>(o.assertVersion(7),{name:"log-jsx-plugin",visitor:{Program(n,s){if(s.filename?.includes(m.resolve(g,"../../../vynn")))return;let i=!1;if(n.get("body").forEach(r=>{r.isImportDeclaration()&&r.node.source.value==="vynn/jsx-runtime"&&r.node.specifiers.forEach(t=>{if(e.isImportSpecifier(t)){const l=t.imported;e.isIdentifier(l)&&l.name==="logJsx"&&(i=!0)}})}),!i){const r=e.importDeclaration([e.importSpecifier(e.identifier("logJsx"),e.identifier("logJsx"))],e.stringLiteral("vynn/jsx-runtime"));n.unshiftContainer("body",r)}},CallExpression(n){const s=n.get("callee");if(e.isMemberExpression(s.node)&&e.isIdentifier(s.node.object,{name:"console"})&&e.isIdentifier(s.node.property)){const i=n.node.arguments.map(r=>e.isJSXElement(r)||e.isJSXFragment(r)?e.callExpression(e.identifier("logJsx"),[r]):r);i.some((r,t)=>r!==n.node.arguments[t])&&(n.node.arguments=i)}}}})),h=c(o=>(o.assertVersion(7),{name:"loop-auto-wrap-plugin",pre(){const n=this.file.metadata;n.importedLoops=new Set,n.localLoops=new Set},visitor:{Program(n,s){const i=s.file.metadata,r=i.importedLoops,t=i.localLoops;n.get("body").forEach(l=>{l.isImportDeclaration()&&l.node.source.value==="vynn"&&l.node.specifiers.forEach(a=>{e.isImportSpecifier(a)&&e.isIdentifier(a.imported,{name:"loop"})&&r.add(a.local.name)}),l.isFunctionDeclaration()&&e.isIdentifier(l.node.id)&&t.add(l.node.id.name),l.isVariableDeclaration()&&l.node.declarations.forEach(a=>{e.isIdentifier(a.id)&&t.add(a.id.name)})})},CallExpression(n,s){const i=s.file.metadata,r=i.importedLoops,t=i.localLoops,l=n.get("callee");if(!l.isIdentifier())return;const a=l.node.name;if(r.has(a)&&!t.has(a)&&n.node.arguments.length===1){const u=n.node.arguments[0];!e.isArrowFunctionExpression(u)&&e.isExpression(u)&&(n.node.arguments[0]=e.arrowFunctionExpression([],u))}}}})),v=c(o=>{o.assertVersion(7);function n(s){const i=[];if(s.node.children.forEach((t,l)=>{if(e.isJSXText(t)){let a=t.value;(!a.includes(`
`)||a.trim()!=="")&&(l===0&&(a=a.trimStart()),l===s.node.children.length-1&&(a=a.trimEnd()),i.push(e.arrowFunctionExpression([],e.stringLiteral(a))))}else if(e.isJSXElement(t)||e.isJSXFragment(t))i.push(e.arrowFunctionExpression([],t));else if(e.isJSXExpressionContainer(t)&&!e.isJSXEmptyExpression(t.expression)){const a=t.expression;e.isStringLiteral(a)?i.push(a):i.push(e.arrowFunctionExpression([],a))}}),i.length===0)return;let r=i.length===1?i[0]:e.arrayExpression(i);e.isArrowFunctionExpression(r)||(r=e.arrowFunctionExpression([],r)),s.node.children=[e.jsxExpressionContainer(r)]}return{name:"wrap-jsx-children-plugin",visitor:{JSXElement(s){n(s)},JSXFragment(s){n(s)}}}}),J=c(o=>(o.assertVersion(7),{name:"wrap-jsx-expression-plugin",visitor:{JSXOpeningElement(n){const s=n.node.attributes.map(i=>{if(!e.isJSXAttribute(i)||!i.value)return i;const r=e.isJSXIdentifier(i.name)?i.name.name:null;if(r==="ref"&&e.isJSXExpressionContainer(i.value)&&e.isIdentifier(i.value.expression)){const a=i.value.expression,u=e.identifier("elem"),d=e.assignmentExpression("=",a,u),x=e.arrowFunctionExpression([u],d);return e.jsxAttribute(e.jsxIdentifier(r),e.jsxExpressionContainer(x))}let t=null;if(e.isStringLiteral(i.value)?t=i.value:e.isJSXExpressionContainer(i.value)&&(e.isJSXEmptyExpression(i.value.expression)||(t=i.value.expression)),t===null||r===null)return i;const l=e.arrowFunctionExpression([],t);return e.jsxAttribute(e.jsxIdentifier(r),e.jsxExpressionContainer(l))});n.node.attributes=s},JSXExpressionContainer(n){const s=n.node.expression;if(e.isJSXEmptyExpression(s)||e.isFunction(s)||e.isArrowFunctionExpression(s)||e.isLiteral(s))return;const i=e.arrowFunctionExpression([],s);n.replaceWith(e.jsxExpressionContainer(i))}}}));function p(o){return o?e.isJSXElement(o)||e.isJSXFragment(o)?!0:e.isConditionalExpression(o)?p(o.consequent)||p(o.alternate):e.isLogicalExpression(o)?p(o.left)||p(o.right):e.isArrayExpression(o)?o.elements.some(n=>n&&!e.isSpreadElement(n)?p(n):!1):!1:!1}const w=c(o=>(o.assertVersion(7),{name:"wrap-jsx-variables",visitor:{VariableDeclarator(n){const s=n.node.init;s&&p(s)&&!e.isArrowFunctionExpression(s)&&(n.node.init=e.arrowFunctionExpression([],s))},AssignmentExpression(n){const s=n.node.right;p(s)&&!e.isArrowFunctionExpression(s)&&(n.node.right=e.arrowFunctionExpression([],s))}}}));function F(o,n={ssr:!1}){return o.assertVersion(7),{plugins:[[f,{runtime:"automatic",importSource:n.ssr?"vynn/server":"vynn",jsx:"preserve"}],S,w,h,v,J]}}export{F as default};
//# sourceMappingURL=index.js.map
