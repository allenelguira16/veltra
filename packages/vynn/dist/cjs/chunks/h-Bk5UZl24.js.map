{"version":3,"file":"h-Bk5UZl24.js","sources":["../../../src/server/apply-props.ts","../../../src/server/render-children-to-string.ts","../../../src/server/h.ts"],"sourcesContent":["/**\n * Handle the properties of the element for SSR\n *\n * @param props - The properties of the element.\n * @returns The transformed properties.\n */\nexport function applyProps(props: Record<string, any>) {\n  const transformedProps: string[] = [];\n\n  for (const key in props) {\n    if (key.startsWith(\"on\") && typeof props[key] === \"function\") {\n      continue;\n    }\n\n    const value = typeof props[key] === \"function\" ? props[key]() : props[key];\n\n    if (key === \"ref\") {\n      continue;\n    }\n\n    if (key === \"style\") {\n      continue;\n    }\n\n    if (key === \"html\") {\n      continue;\n    }\n\n    if (typeof value === \"boolean\") {\n      if (value) transformedProps.push(key);\n      continue;\n    }\n\n    transformedProps.push(`${key}=\"${value}\"`);\n  }\n\n  if (transformedProps.length > 0) transformedProps.unshift(\"\");\n\n  return transformedProps.join(\" \");\n}\n","import { JSX } from \"~/types\";\nimport { isNil, toArray } from \"~/util\";\n\n/**\n * Handle the children of the element for SSR\n *\n * @param children - The children of the element.\n * @returns The transformed children.\n */\nexport function renderChildrenToString(children: JSX.Element) {\n  function renderRecursive(value: JSX.Element) {\n    const transformedChildren: string[] = [];\n\n    const resolvedChildren = value instanceof Function ? value() : value;\n    const children = toArray(resolvedChildren);\n\n    for (const child of children) {\n      if (isNil(child)) continue;\n\n      if (typeof child === \"function\") {\n        transformedChildren.push(renderRecursive(child));\n      } else {\n        const resolved = getNode(child);\n        transformedChildren.push(resolved);\n      }\n    }\n    return transformedChildren.join(\"\");\n  }\n\n  return renderRecursive(children);\n}\n\n/**\n * get the node for a JSX element\n *\n * @param jsxElement - The JSX element to get the node for.\n * @returns The node for the JSX element.\n */\nexport function getNode<T extends string>(jsxElement: JSX.Element): T {\n  if (typeof jsxElement === \"string\" || typeof jsxElement === \"number\") {\n    return String(jsxElement) as unknown as T;\n  }\n\n  throw new Error(`Unknown value: ${jsxElement}`);\n}\n","import { getSuspenseSSRHandler } from \"~/component\";\nimport { resolveComponentProps } from \"~/render/mount-component/resolve-component-props\";\n\nimport { applyProps } from \"./apply-props\";\nimport { renderChildrenToString } from \"./render-children-to-string\";\n\nconst voidElements = new Set([\n  \"area\",\n  \"base\",\n  \"br\",\n  \"col\",\n  \"embed\",\n  \"hr\",\n  \"img\",\n  \"input\",\n  \"link\",\n  \"meta\",\n  \"param\",\n  \"source\",\n  \"track\",\n  \"wbr\",\n]);\n\n/**\n * Create a JSX element for SSR\n *\n * @param type - The type of the element.\n * @param props - The properties of the element.\n * @param children - The children of the element.\n * @returns The JSX element for SSR.\n */\nexport function h<T extends Record<string, any> & { children?: (...args: any[]) => string }>(\n  type: string | ((props: T) => string | (() => string)),\n  props: Record<string, any>,\n  children?: T[\"children\"],\n) {\n  if (typeof type === \"function\") {\n    resolveComponentProps(type, props);\n\n    const resolved = type({ ...props, children } as T);\n    const handler = getSuspenseSSRHandler();\n    try {\n      return normalizeToString(resolved);\n    } catch (error) {\n      if (error instanceof Promise) {\n        return handler?.() || null;\n      }\n\n      throw error;\n    }\n  }\n\n  if (voidElements.has(type)) {\n    return `<${type}${applyProps(props)}>`;\n  }\n\n  return `<${type}${applyProps(props)}>${renderChildrenToString(\"html\" in props ? props[\"html\"] : children)}</${type}>`;\n}\n\nfunction normalizeToString(value: unknown): string {\n  if (value == null) return \"\";\n\n  if (typeof value === \"function\") {\n    return normalizeToString(value());\n  }\n\n  if (Array.isArray(value)) {\n    return value.map(normalizeToString).join(\"\");\n  }\n\n  return String(value);\n}\n"],"names":["applyProps","props","transformedProps","key","startsWith","value","push","length","unshift","join","renderChildrenToString","children","renderRecursive","transformedChildren","resolvedChildren","Function","toArray","child","isNil","resolved","getNode","jsxElement","String","Error","voidElements","Set","h","type","resolveComponentProps","handler","getSuspenseSSRHandler","normalizeToString","error","Promise","has","Array","isArray","map"],"mappings":"8CAMO,SAASA,EAAWC,EAA4B,CACrD,MAAMC,EAA6B,CAAA,EAEnC,UAAWC,KAAOF,EAAO,CACvB,GAAIE,EAAIC,WAAW,IAAI,GAAK,OAAOH,EAAME,CAAG,GAAM,WAChD,SAGF,MAAME,EAAQ,OAAOJ,EAAME,CAAG,GAAM,WAAaF,EAAME,CAAG,EAAA,EAAMF,EAAME,CAAG,EAEzE,GAAIA,IAAQ,OAIRA,IAAQ,SAIRA,IAAQ,OAIZ,CAAA,GAAI,OAAOE,GAAU,UAAW,CAC1BA,GAAOH,EAAiBI,KAAKH,CAAG,EACpC,QACF,CAEAD,EAAiBI,KAAK,GAAGH,CAAG,KAAKE,CAAK,GAAG,CAAA,CAC3C,CAEA,OAAIH,EAAiBK,OAAS,GAAGL,EAAiBM,QAAQ,EAAE,EAErDN,EAAiBO,KAAK,GAAG,CAClC,CC9BO,SAASC,EAAuBC,EAAuB,CAC5D,SAASC,EAAgBP,EAAoB,CAC3C,MAAMQ,EAAgC,CAAA,EAEhCC,EAAmBT,aAAiBU,SAAWV,EAAAA,EAAUA,EACzDM,EAAWK,EAAAA,QAAQF,CAAgB,EAEzC,UAAWG,KAASN,EAClB,GAAIO,CAAAA,EAAAA,MAAMD,CAAK,EAEf,GAAI,OAAOA,GAAU,WACnBJ,EAAoBP,KAAKM,EAAgBK,CAAK,CAAC,MAC1C,CACL,MAAME,EAAWC,EAAQH,CAAK,EAC9BJ,EAAoBP,KAAKa,CAAQ,CACnC,CAEF,OAAON,EAAoBJ,KAAK,EAAE,CACpC,CAEA,OAAOG,EAAgBD,CAAQ,CACjC,CAQO,SAASS,EAA0BC,EAA4B,CACpE,GAAI,OAAOA,GAAe,UAAY,OAAOA,GAAe,SAC1D,OAAOC,OAAOD,CAAU,EAG1B,MAAM,IAAIE,MAAM,kBAAkBF,CAAU,EAAE,CAChD,CCtCA,MAAMG,EAAe,IAAIC,IAAI,CAC3B,OACA,OACA,KACA,MACA,QACA,KACA,MACA,QACA,OACA,OACA,QACA,SACA,QACA,KAAK,CACN,EAUM,SAASC,EACdC,EACA1B,EACAU,EACA,CACA,GAAI,OAAOgB,GAAS,WAAY,CAC9BC,EAAAA,sBAAsBD,EAAM1B,CAAK,EAEjC,MAAMkB,EAAWQ,EAAK,CAAE,GAAG1B,EAAOU,SAAAA,CAAS,CAAM,EAC3CkB,EAAUC,wBAAAA,EAChB,GAAI,CACF,OAAOC,EAAkBZ,CAAQ,CACnC,OAASa,EAAO,CACd,GAAIA,aAAiBC,QACnB,OAAOJ,OAAe,KAGxB,MAAMG,CACR,CACF,CAEA,OAAIR,EAAaU,IAAIP,CAAI,EAChB,IAAIA,CAAI,GAAG3B,EAAWC,CAAK,CAAC,IAG9B,IAAI0B,CAAI,GAAG3B,EAAWC,CAAK,CAAC,IAAIS,EAAuB,SAAUT,EAAQA,EAAM,KAAUU,CAAQ,CAAC,KAAKgB,CAAI,GACpH,CAEA,SAASI,EAAkB1B,EAAwB,CACjD,OAAIA,GAAS,KAAa,GAEtB,OAAOA,GAAU,WACZ0B,EAAkB1B,GAAO,EAG9B8B,MAAMC,QAAQ/B,CAAK,EACdA,EAAMgC,IAAIN,CAAiB,EAAEtB,KAAK,EAAE,EAGtCa,OAAOjB,CAAK,CACrB"}