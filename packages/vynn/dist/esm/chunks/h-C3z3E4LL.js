const $=new Map,se=e=>{let n;return e!==void 0?($.has(e)||$.set(e,{states:[]}),n=$.get(e)):n={states:[]},{...n,index:0}};let O=null;function U(e){O=e}function w(){return O}let l=null;function W(e){l=e}let E=null;const k=new Set;let H=!1;function ce(e){k.add(e),H||(H=!0,queueMicrotask(()=>{for(const n of k)n();k.clear(),H=!1}))}function S(e){const n=w(),t=async()=>{T(t),t.cleanup&&(t.cleanup(),t.cleanup=void 0);const r=l;l=t,n&&n.effect.push(t);try{const s=e();if(typeof s=="function")t.cleanup=s;else if(s instanceof Promise){const u=await s;typeof u=="function"&&(t.cleanup=u)}}finally{l=r}},o=()=>T(t);return E=o,t.deps=[],t(),o}function ue(){E&&(E(),E=null)}function T(e){if(e.deps){for(const n of e.deps)n.delete(e);e.deps.length=0}e.cleanup&&(e.cleanup(),e.cleanup=void 0)}const P=new WeakMap;function j(e,n){if(!l)return;let t=P.get(e);t||(t=new Map,P.set(e,t));let o=t.get(n);o||(o=new Set,t.set(n,o)),o.has(l)||(o.add(l),l.deps?l.deps.push(o):l.deps=[o])}function B(e,n){const t=P.get(e);if(!t)return;const o=t.get(n);if(o)for(const r of o)ce(r)}function x(e){const n=w();if(n&&n.state){const{states:t,index:o}=n.state;if(t.length<=o){const r=z(e);t.push(r)}return t[n.state.index++]}return z(e)}function z(e){const n={value:e};return new Proxy(n,{get(t,o,r){return j(t,o),Reflect.get(t,o,r)},set(t,o,r,s){const u=t[o],f=Reflect.set(t,o,r,s);return u!==r&&B(t,o),f}})}function J(e){const n=l;W(null);try{return e()}finally{W(n)}}const N=new WeakMap;function ie(e,n,t){let o=N.get(e);o||(o=new Map,N.set(e,o)),o.has(n)&&e.removeEventListener(n,o.get(n)),e.addEventListener(n,t),o.set(n,t)}function fe(e,n){const t=N.get(e);if(!t)return;const o=t.get(n);o&&(e.removeEventListener(n,o),t.delete(n)),t.size===0&&N.delete(e)}function ae(e,n){for(const t in n)S(()=>{const o=n[t],r=typeof o=="function"&&t!=="ref"?o():o;if(t.startsWith("on")&&e instanceof HTMLElement){const u=t.slice(2).toLowerCase();return ie(e,u,r),()=>fe(e,u)}const s=e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement;if(t==="value"&&s&&typeof n.onInput!="function"&&typeof n.onChange!="function"){e.value=r;const u=()=>{e.value!==r&&(e.value=r)};return e.setAttribute(t,r),e.addEventListener("input",u),()=>e.removeEventListener("input",u)}if(t==="ref"&&typeof r=="function"){r(e);return}if(t==="style"&&typeof r=="object"&&e instanceof HTMLElement){pe(e,r);return}if(typeof r=="boolean"){e.toggleAttribute(t,r);return}if(t==="html"&&typeof r=="string"){e.innerHTML=r;return}e.setAttribute(t,r)})}function le(e){return CSS.supports(e,"0")&&!CSS.supports(e,"0px")}function pe(e,n){if(e instanceof HTMLElement)for(const t in n){if(!Object.hasOwn(n,t))continue;const o=n[t];if(o==null||t==="length"||t==="parentRule")continue;const r=typeof o=="number",s=r&&!le(t);e.style[t]=r?s?`${o}px`:`${o}`:String(o)}}function de(e){let n;return process.env.NODE_ENV,n=document.createTextNode(""),te.add(n),n}const V=e=>e==null||e===!1;function he(e){if(p)return e;const n=document.createDocumentFragment();C(n,e);const t=[...Array.from(n.childNodes).filter(o=>!te.has(o))];return t.length===1?t[0]:t}function D(e){let n,t=!0;return(...o)=>(t&&(n=e(...o),t=!1),n)}const F=e=>(Array.isArray(e)?e:[e]).flat(1/0),p=typeof window>"u",q=new Map;function me(e,n){q.set(e,n)}function R(e){const n=q.get(e);if(n){for(const t of n)t();q.delete(e)}for(const t of e.childNodes)R(t)}function ge(e){return{id:crypto.randomUUID(),mount:[],state:se(e),effect:[],destroy:[]}}function _(e){if(p)return;const n=w();if(!n)throw new Error("onDestroy called outside of component");n.destroy.push(e)}function G(e){if(p)return;const n=w();if(!n)throw new Error("onMount called outside of component");n.mount.push(e)}function ye(e,n){if(!n)return;const t=[];me(e,t);const o=async()=>{for(const r of n.mount){const s=await r();s&&t.push(s)}for(const r of n.destroy)t.push(r);for(const r of n.effect)t.push(()=>Promise.resolve(T(r)))};queueMicrotask(()=>Promise.resolve().then(o))}const L=[],M=[];function K(){return L[L.length-1]}function ve(){return M[M.length-1]}function Q(e){const{fallback:n,children:t}=e,o=D(()=>t()),r=n?D(()=>n()):void 0;if(p)return r?.();const s=x(()=>r?.()),u=()=>(M.pop(),r?.()),f=c=>{L.pop(),queueMicrotask(()=>{r&&(s.value=r)}),c.then(()=>{d(o)})},d=c=>{p?M.push(u):L.push(f);try{s.value=c}catch(i){if(i instanceof Promise)p?s.value=()=>{throw i}:f(i);else throw i}};function h(c){if(!A().isHydrating){c();return}requestAnimationFrame(()=>h(c))}try{return()=>s.value()}finally{h(()=>{d(o)})}}function we({children:e}){return e}const X=(e,{children:n,...t}={},o)=>oe(e,t,n,o);function Ee(e){return{each(n){const t=e;return n=n,p?t().map((o,r)=>n(o,{value:r})):X(Y,{each:t,children:n})}}}function Y({each:e,children:n}){const t=K(),o=x([]),r=Se(e,n);return S(()=>{try{o.value=r()}catch(s){if(s instanceof Promise&&t)t(s);else throw s}}),()=>o.value}function Se(e,n){let t=[];return()=>{const o=e()||[],r=o.length,s=new Array(r),u=new Map;for(let c=0;c<t.length;c++){const i=t[c].value;u.has(i)||u.set(i,[]),u.get(i).push(c)}const f=new Array(r).fill(-1);for(let c=0;c<r;c++){const i=o[c],a=u.get(i);if(a&&a.length){const m=a.shift();f[c]=m,s[c]=t[m]}else{const m=x(c),g=n(i,m);s[c]={value:i,index:m,element:g}}}for(let c=0;c<t.length;c++)if(!f.includes(c)){const i=t[c].element;i.parentNode?.removeChild(i)}const d=xe(f);let h=d.length-1;for(let c=r-1;c>=0;c--){const i=s[c];if(f[c]===-1||c!==d[h]){const a=c+1<r?s[c+1].element:null;i.element.parentNode?.insertBefore(i.element,a)}else h--;i.index.value=c}return t=s,t.map(c=>c.element)}}function xe(e){const n=e.slice(),t=[];let o,r;for(let s=0;s<e.length;s++){const u=e[s];if(!(u<0)){if(t.length===0||e[t[t.length-1]]<u){n[s]=t.length>0?t[t.length-1]:-1,t.push(s);continue}for(o=0,r=t.length-1;o<r;){const f=(o+r)/2|0;e[t[f]]<u?o=f+1:r=f}u<e[t[o]]&&(o>0&&(n[s]=t[o-1]),t[o]=s)}}for(o=t.length,r=t[o-1];o-- >0;)t[o]=r,r=n[r];return t}function Z({children:e,target:n}){let t;return G(()=>{const o=(n instanceof Function?n():n)??document.body;t=C(o,e)}),_(()=>{t()}),null}function Ne(e){if(e instanceof Node)return e;if(typeof e=="string"||typeof e=="number"){const{currentNode:n,next:t}=A();return n?(t(),n):document.createTextNode(String(e))}throw new Error(`Unknown value: ${e}`)}function C(e,n){const t=[];function o(s,u){let f=[],d=[];const h=()=>{for(const a of f)R(a),a.parentNode===e&&e.removeChild(a);for(const a of d)a();f=[],d=[]},c=K(),i=S(()=>{try{h();const a=s instanceof Function?s():s,m=F(a);for(const g of m)if(!V(g))if(typeof g=="function"){const y=document.createTextNode("");e.insertBefore(y,u);const re=o(g,y);d.push(re),f.push(y)}else{const y=Ne(g);e.insertBefore(y,u),f.push(y)}}catch(a){if(a instanceof Promise)c?.(a);else throw a}});return()=>{i(),h()}}const r=o(n,null);return t.push(r),()=>{console.log("run");for(const s of t)s()}}const Le=[Q,Y,Z];function ee(e,n){if(!Le.includes(e))for(const t in n)n[t]=n[t]instanceof Function?n[t]():n[t]}const te=new WeakSet;function ne(e,n={},t,o){ee(e,n);const r=o?o().toString()+e.toString():void 0,s=ge(r);U(s);const u=de(e.name),f=F([u,J(()=>e({...n,children:t}))]).flat();return U(null),ye(u,s),f}queueMicrotask(()=>{p||new MutationObserver(e=>{for(const n of e)for(const t of n.removedNodes)R(t)}).observe(document.body,{childList:!0,subtree:!0})});let b=[],I=0;function A(){return{renderedNodes:b,get currentNode(){if(!p)return b[I]},get isHydrating(){return!!b[I]},next:()=>I++}}function Me(e){b=e}function oe(e,n,t,o){if(typeof e=="function")return ne(e,n,t,o);if(e==="html")return t;v.push(n.xmlns?.()??v[v.length-1]);const r=Ce(e);return ae(r,n),C(r,t),v.pop(),r}const v=[];function Ce(e){const{currentNode:n,next:t}=A();if(n instanceof Element)try{if(n.tagName.toLocaleLowerCase()!==e)throw new Error("Hydration mismatch because the initial UI does not match what was rendered on the server");return n}finally{t()}const o=v[v.length-1];return o?document.createElementNS(o,e):document.createElement(e)}export{we as F,Z as P,Q as S,j as a,A as b,ne as c,Me as d,S as e,G as f,ue as g,X as h,p as i,oe as j,he as k,Ee as l,D as m,F as n,_ as o,V as p,ee as q,C as r,x as s,B as t,J as u,ve as v};
